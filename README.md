# VoronoiGame
Copyright © 2018年 K.Hirano All rights reserved. 

作成日2018/11/08 

最終更新日2018/11/16



## 0. ゲームの説明

ゲームのおおまかな説明は省略するが，今後の説明のために，用語を定義しておく

### 用語

| 用語            | 内容                                                         |
| --------------- | ------------------------------------------------------------ |
| 盤/盤面         | 扱うグラフのこと．<br />今回は10*10のグリッドグラフに決まった数の重み（得点）を配置するが，<br />重みはランダムに与える．重みの設定が違う盤は違う盤とみなす． |
| 手番順序        | 公平さを保つために，一つの盤に対して全ての手番順で対戦をする．<br />したがって，3人プレイ時には，1つの盤に対して$3!$回対戦する． |
| ゲーム番号$i$   | $i$回目のゲーム．ゲームごとに盤面は変わる．                  |
| 手番順序番号$s$ | 手番順序に対して与えられた番号．<br />ゲーム番号が同じであれば，手番順序番号が異なっても盤面は同じ． |
| ゲーム$(i,s)$   | ゲーム番号$i$，手番順序$s$の対戦．                           |
| ターン$j$       | ノードを3個選択するとき，1個目の選択をターン0，2個目の選択をターン1,...とする． |



## 1. 環境の準備

ここでは，環境の準備をしながら対戦の実行方法の一例を紹介する．

### 1.0 ターミナル

ターミナルを使える環境を用意してください．なお，shellが使えると嬉しいです．

Cygwinなどで問題ないはずです．

### 1.1 clone

ターミナルで以下を実行

`git clone https://github.com/a14ehsr/VoronoiGame.git`

もしくはdownload zipからダウンロードしてホームディレクトリ上に解凍してください．  

### 1.2 カレントディレクトリを移動

ターミナルで以下を実行

`cd VoronoiGame`



### 1.3 サンプルを動かしてみる

#### サンプルAIのコピー

`sample_programs`に各言語のサンプルが用意されているので，

プログラムをプールするディレクトリの`ai_programs` にコピーする．

以下を実行すれば良い．

```
cp sample_programs/cpp/P_sample.cpp ai_programs/
cp sample_programs/java/P_Sample.java ai_programs/
cp sample_programs/python/P_sample.py ai_programs/
```



#### プラットフォームのコンパイル

以下を実行する．

```
sh shell/compile.sh
```



#### AIのプログラムをコンパイルする

以下を実行することで，`ai_programs`内の`P_`から始まるプログラムを自動でコンパイルし，

実行コマンドリストのテキストファイルを生成する．

```a
sh shell/auto_compile.sh
```



#### テスト実行する

以下を実行することで，プラットフォームが用意している単純なAIとテスト対戦を行う．

これによって，実行時エラーが発生するプログラムを除いた，

対戦プログラムの実行コマンドリストのテキストファイルを生成する．

 ```
sh shell/test.sh
 ```



#### 対戦を実行する

##### 2人対戦

以下を実行することで，先に用意した対戦プログラムとプラットフォームが用意している単純なAIを合わせた

全ての組み合わせの対戦を実行する．

```
sh shell/auto_run.sh 2
```

以下の様な出力が出れば，問題ない．

```
設定終了
players  : P_SampleCpp P_SampleJava
勝ち点合計:38 21
players  : P_SampleCpp P_SamplePython
勝ち点合計:34 26
players  : P_SampleCpp P_Random
勝ち点合計:33 26
players  : P_SampleJava P_SamplePython
勝ち点合計:36 23
players  : P_SampleJava P_Random
勝ち点合計:24 36
players  : P_SamplePython P_Random
勝ち点合計:28 32
RESULT
                          0    1    2    3  | r1 r2 (times)
  0,       P_SampleCpp    0   38   34   33  |  0  3
  1,      P_SampleJava   21    0   36   24  |  2  1
  2,    P_SamplePython   26   23    0   28  |  3  0
  3,          P_Random   26   36   32    0  |  1  2
```

###### RESULTの見方

プレイヤー0がプレイヤー1と戦った時に，勝ち点38を記録し……と読み，

 r1(1位)を0回，r2(2位)を3回取ったと読む．



##### 3人対戦

上の例では，2人対戦を行なったが，以下の実行で3人対戦もできる．

```
sh shell/auto_run.sh 3
```



## 2. AIプログラムの準備

1.3でコピーしたプログラムを改変して，それぞれのAIを作ります．

ファイル名を`P_` から始まる適当な名前に変更することを推奨します．

### 2.1 AIの作り方．
前準備として，playerNameを書き換えてください．(例: playerNmae = "Yamada Taro") 
サンプルの関数`select`を修正して，設計したAIを実装します．

#### __コーディングにあたっての注意事項__
デバッグなどの出力を行いたい場合には，**必ず** 標準エラー出力を使用してください．

標準エラー関数は以下のようなものがそれぞれの言語にあります（他にもある場合があります）．

| 言語   | 関数                  |
| ------ | --------------------- |
| C++    | std::cerr >> str      |
| Java   | System.err.print(str) |
| Python | sys.stderr.write(str) |

### 2.2 サンプルプログラムの詳細

#### グラフについて

グラフは一般のグラフにも対応できるようにデータを受け取ります．

サンプルプログラム内の関数`loadGraph`で読み込みを行なっています．

具体的に受け取る情報は以下の通りです．

| 変数名          | 内容                 |
| --------------- | -------------------- |
| $numberOfNodes$ | ノード数             |
| $numberOfEdges$ | 辺数                 |
| $weight$        | 各ノードの重み       |
| $edges$         | 各辺の両端ノード番号 |

今回使用しているグラフはグリッドグラフなので，各自都合の良いように書き換えても構いません．

グリッドの左上から右方向に$0,1,...numberOfNodes$ という並びです．

ただし，選択するノード番号は，入力されたグラフのノード番号なので，

データ構造を変更する場合には気をつけてください．



#### パラメタについて

| 変数名              | 説明                                                         |
| ------------------- | ------------------------------------------------------------ |
| numberOfPlayers     | 対戦プレイヤー数（何人対戦なのか）                           |
| numberOfGames       | 対戦ゲーム数                                                 |
| numberOfSelectNodes | 1ゲームあたりに選択するノードの数                            |
| patternSize         | 対戦手番順序の種類数（2人対戦なら$2!=2$, 3人対戦なら$3!=6$） |
| playerCode          | プレイヤーの識別番号（0からnumberOfPlayers-1までのいずれか） |
| numberOfNodes       | グラフのノード数                                             |
| numberOfEdges       | グラフの辺数                                                 |
| edges               | グラフの辺情報の2次元配列（ノードedges[$i$][0]とノードedges[$i$][1]の間に辺がある） |
| weight              | グラフのノードの重み情報の1次元配列（ノード$i$の重みはweight[$i$]） |



#### 関数`select`について

関数にはそれまでのゲームの記録を渡している．

引数の説明は以下の通りです．

| 変数名         | 説明                                                         |
| -------------- | ------------------------------------------------------------ |
| gameRecord     | ゲームごとにノードの獲得状況を記録した4次元配列              |
| game           | 現在のゲーム番号（0からnumberOfPlayers-1までのいずれか）     |
| sequenceNumber | 現在の手番順番番号（0からpatternSize-1までのいずれか）       |
| sequence       | 手番順序の配列（またはリスト）．中身はプレイヤーの識別番号． |

##### gameRecordについて

- gameRecord[$i$][$s$][$j$][0]はゲーム$(i, s)$のノード$j$の獲得プレイヤー番号
- gameRecord[$i$][$s$][$j$][1]はゲーム$(i, s)$のノード$j$の獲得ターン



##  3. サンプルと対戦

完成したプログラムで対戦させてみましょう．

###  3.1 コンパイル

作ったプログラムをコンパイルします．

普通にコンパイルしても良いですし，

プログラムが`ai_programs`にあるのであれば，

1.3で使った自動コンパイルプログラムを使用してください．

###### 再掲

```
sh shell/auto_compile.sh
```



### 3.2 サンプルと戦わせる

サンプルプログラムと対戦させます．以下のコマンドを実行してください. 

```
sh shell/run_sample.sh 実行コマンド
```

実行コマンドには`"./a.out"`や`"java P_Name"` などを入力してください．

コマンドを一つの文字列とみなす必要があるので，

実行コマンドに空白文字が含まれる場合には`"`で囲ってください．

サンプルは以下の内容です．

| 名前     | 戦略                                 |
| -------- | ------------------------------------ |
| P_Random | 取得可能なノードをランダムに選択する |

また，以下のコマンドでサンプルとの対戦をしつつ，描画もできます．

```
sh shell/run_sample_visible.sh 実行コマンド
```



### 3.3 細かにオプションを指定する

以下の実行コマンドに対し，複数のオプションを入力することで，対戦の設定や出力を変更できる．

```
sh shell/run_normal.sh
```

| オプション  | 説明                                                         | defalut |
| ----------- | ------------------------------------------------------------ | ------: |
| -p str      | 実行コマンドリストにstrを追加する                            |       - |
| -nop num    | 対戦人数をnumに設定する                                      |       2 |
| -nosn num   | 1ゲームの選択ノード数をnumに設定する                         |       7 |
| -game num   | ゲーム数を設定する                                           |      30 |
| -v bool     | 描画を行う<br />（ゲーム数やAIの数が多い時は終わらなくなるかもしれないので注意） |   false |
| -olevel num | 出力レベルをnumに設定する                                    |       1 |
| -auto bool  | resource/command_list/command_list_green.txtの<br />実行コマンドを実行コマンドリストに追加する．<br />trueの場合，サンプルプログラムを一緒に追加する． |       - |
| -test num   | resource/command_list/command_list.txtの実行コマンドを<br />の実行コマンドとサンプルプログラムでnum回ゲームを行う． |       - |

また，出力レベルは以下の通りである．

| レベル | 出力内容                                              |
| ------ | ----------------------------------------------------- |
| 1      | 対戦の結果（勝ち点）のみ                              |
| 2      | レベル1の内容に加えて各ゲームの利得を出力             |
| 3      | レベル2の内容に加えて各ゲームのノードの獲得状況を出力 |

また，以上のオプションを組み合わせたいくつかのshellscriptを用意している．

| 実行方法                                                     | 内容                                                |
| ------------------------------------------------------------ | --------------------------------------------------- |
| `sh shell/run.sh num "実行コマンド" "実行コマンド" ("実行コマンド")  ` | 対戦人数numで，実行コマンドを対戦させる．           |
| `sh shell/run_visible.sh num "実行コマンド" "実行コマンド" `("実行コマンド") | 対戦人数numで，実行コマンドを対戦させ，描画も行う． |



## 4. 動作確認済み環境
### Java
~~~
java version "1.8.0_162"
Java(TM) SE Runtime Environment (build 1.8.0_162-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.162-b12, mixed mode)
~~~
### Python
~~~
Python 3.6.3 |Anaconda, Inc.| (default, Oct  6 2017, 12:04:38) 
[GCC 4.2.1 Compatible Clang 4.0.1 (tags/RELEASE_401/final)] on darwin
~~~
### PC
~~~
macOS 10.13.4
~~~

### 補足
Java, Pythonのバージョン違いによる動作の可否は未確認です．

また，Windows環境での実行方法なども不明瞭ですが，よくある例として，

Javaプログラムのコンパイル時にエンコードの指定を行わないとエラーになる，などがあります．



## 5. 多対多実行について
先に説明した通り，複数のプログラムで自動対戦を行う機能があります．

コンパイル処理はPythonで実装しています．

`ai_programs/`に使用するプログラムを配置してください．

なお，`P_`から始まるプログラムのみを対象にしています．

ディレクトリ内部を再帰的に探索して実行ファイルを取得するので，ディレクトリなどは適当な構成で問題ありません．

